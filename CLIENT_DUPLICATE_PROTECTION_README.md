# –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Å—Ç–æ—Ä–æ–Ω–µ

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ–º –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç" —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏ –º–æ–≥–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –¥—É–±–ª–∏—Ä—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

## –†–µ—à–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Å—Ç–æ—Ä–æ–Ω–µ:

### 1. –ó–∞—â–∏—Ç–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

- **–î–≤–æ–π–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞**: `if (isCompleted || isSubmitting) return;`
- **–§–ª–∞–≥ –æ—Ç–ø—Ä–∞–≤–∫–∏**: `isSubmitting` –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤—ã–∑–æ–≤—ã
- **–§–ª–∞–≥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: `isCompleted` –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–∫–∏

### 2. –ó–∞—â–∏—Ç–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ UI

- **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏**: `disabled={isSubmitting || isCompleted}`
- **–í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è**:
  - "–û—Ç–ø—Ä–∞–≤–∫–∞..." –≤–æ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏
  - "–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω" –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
  - "–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç" –≤ –æ–±—ã—á–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏

### 3. –ó–∞—â–∏—Ç–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ localStorage

- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏**: –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–ª–∞–≥–∞**: `isCompleted: true` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage
- **–û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö**: localStorage –æ—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–µ—Ä–≤–µ—Ä–∞

- **HTTP 409 (Conflict)**: —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è**: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø—Ä–∏—á–∏–Ω—É –æ—à–∏–±–∫–∏
- **–†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫**: —Å–µ—Ç—å, —Å–µ—Ä–≤–µ—Ä, –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### Tests.js - –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

#### 1. –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `handleCompleteTest`:

```javascript
const handleCompleteTest = async () => {
  if (isCompleted || isSubmitting) return;

  setIsSubmitting(true);
  setSubmitError(null);

  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
  if (isCompleted || isSubmitting) return;

  // ... –ª–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ ...
};
```

#### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ HTTP 409 (Conflict):

```javascript
} else if (response.status === 409) {
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è (—Ç–µ—Å—Ç —É–∂–µ —Å–¥–∞–Ω)
  const errorData = await response.json();
  console.warn('–¢–µ—Å—Ç —É–∂–µ —Å–¥–∞–Ω:', errorData);
  setSubmitError(`–¢–µ—Å—Ç —É–∂–µ –±—ã–ª —Å–¥–∞–Ω —Ä–∞–Ω–µ–µ. –†–µ–∑—É–ª—å—Ç–∞—Ç: ${errorData.existingScore || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'} –±–∞–ª–ª–æ–≤`);
  setIsCompleted(true);

  // –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ—Å—Å–∏—é –≤ localStorage –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—É—é
  const updatedSession = { ...session, isCompleted: true };
  localStorage.setItem('testSession', JSON.stringify(updatedSession));

  onComplete(results);
}
```

#### 3. –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:

```javascript
} catch (error) {
  console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:', error);

  // –†–∞–∑–ª–∏—á–∞–µ–º —Ç–∏–ø—ã –æ—à–∏–±–æ–∫
  if (error.message.includes('409')) {
    setSubmitError('–¢–µ—Å—Ç —É–∂–µ –±—ã–ª —Å–¥–∞–Ω —Ä–∞–Ω–µ–µ. –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞.');
  } else if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
    setSubmitError('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
  } else {
    setSubmitError('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
  }

  setIsSubmitting(false);
  return;
}
```

#### 4. –ó–∞—â–∏—Ç–∞ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–µ—Å—Å–∏–∏:

```javascript
const loadTestFromSession = async (session) => {
  try {
    setLoading(true);

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω –ª–∏ —É–∂–µ —Ç–µ—Å—Ç
    if (session.isCompleted) {
      setError('–≠—Ç–æ—Ç —Ç–µ—Å—Ç —É–∂–µ –±—ã–ª –∑–∞–≤–µ—Ä—à–µ–Ω. –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ.');
      localStorage.removeItem('testSession');
      return;
    }

    // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ ...
  }
}
```

#### 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –∫–Ω–æ–ø–∫–∏:

```javascript
<button
  className="tests_complete_btn"
  onClick={handleCompleteTest}
  disabled={isSubmitting || isCompleted}
>
  {isSubmitting ? (
    <>
      <span className="tests_loading_spinner"></span>
      –û—Ç–ø—Ä–∞–≤–∫–∞...
    </>
  ) : isCompleted ? (
    "–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω"
  ) : (
    "–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç"
  )}
</button>
```

## –£—Ä–æ–≤–Ω–∏ –∑–∞—â–∏—Ç—ã

### 1. **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ** (Prevention)

- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–∑ localStorage

### 2. **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ** (Detection)

- –û–±—Ä–∞–±–æ—Ç–∫–∞ HTTP 409 –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
- –ê–Ω–∞–ª–∏–∑ —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### 3. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ** (Recovery)

- –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–∏
- –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- –û—á–∏—Å—Ç–∫–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## –†–µ–∑—É–ª—å—Ç–∞—Ç

- ‚úÖ **–ù–µ—Ç –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π** –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è** –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ **–ù–∞–¥–µ–∂–Ω–∞—è –∑–∞—â–∏—Ç–∞** –æ—Ç race conditions
- ‚úÖ **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ** –ø–æ—Å–ª–µ –æ—à–∏–±–æ–∫
- ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ UX** –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–ë—ã—Å—Ç—Ä–æ–µ –Ω–∞–∂–∞—Ç–∏–µ**: –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ –Ω–∞–∂–º–∏—Ç–µ "–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç"
2. **–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã**: –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ—Å—Ç–∞
3. **–ü–ª–æ—Ö–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ**: –ø—Ä–∏ –º–µ–¥–ª–µ–Ω–Ω–æ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ
4. **–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ**: –ø–æ–ø—ã—Ç–∫–∞ –ø—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –¥–≤–∞–∂–¥—ã

–í—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è –¥—É–±–ª–µ–π! üéØ
